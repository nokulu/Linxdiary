<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tehtävälista — Linxdiary</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .day-section { margin-bottom: 32px; }
    .day-section h2 { 
      margin: 0 0 16px; 
      font-size: 1.6rem; 
      color: #c7d2fe;
      border-bottom: 2px solid rgba(99,102,241,0.3);
      padding-bottom: 8px;
    }
    .task-list { list-style: none; padding: 0; margin: 0; }
    .task-item { 
      margin: 8px 0; 
      padding: 12px 16px;
      background: rgba(99,102,241,0.08);
      border: 1px solid rgba(148,163,184,0.15);
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .task-item:hover { 
      background: rgba(99,102,241,0.15);
      border-color: rgba(148,163,184,0.3);
      transform: translateX(4px);
    }
    .task-item a {
      color: #e0e7ff;
      text-decoration: none;
      font-weight: 500;
      display: block;
    }
    .task-item a:hover { color: #c7d2fe; }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Siirry sisältöön</a>
  <div class="container">
    <header class="header">
      <div>
        <h1>Linxdiary</h1>
        <p class="subtitle">Tehtävälista (Linux-perusteet)</p>
      </div>
      <nav class="nav">
        <a class="btn secondary" href="./index.html">Etusivu</a>
      </nav>
    </header>

    <section class="section card" id="main-content">
      <div id="task-list">
        <noscript>Ota JavaScript käyttöön nähdäksesi tehtävälistan.</noscript>
      </div>
    </section>

    <footer>
      <p>© Linxdiary</p>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    // Shared slug function
    function slug(text) {
      return text
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '') // strip diacritics
        .replace(/[^a-z0-9 -]/g, '')      // remove non-alphanumeric except space and dash
        .trim()
        .replace(/\s+/g, '-');             // spaces to dash
    }

    (async function() {
      const taskListEl = document.getElementById('task-list');
      try {
        const resp = await fetch('./paivakirja.md', { cache: 'no-cache' });
        if (!resp.ok) throw new Error('Ei voitu ladata päiväkirjaa');
        const md = await resp.text();
        const html = marked.parse(md, { mangle: false, headerIds: false });
        
        // Parse the HTML to extract days and tasks
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        
        const days = [];
        let currentDay = null;
        
        Array.from(tempDiv.children).forEach(el => {
          if (el.tagName === 'H2') {
            if (currentDay) days.push(currentDay);
            currentDay = { title: el.textContent.trim(), tasks: [] };
          } else if (el.tagName === 'H3' && currentDay) {
            const taskTitle = el.textContent.trim();
            const taskSlug = slug(taskTitle);
            currentDay.tasks.push({ title: taskTitle, slug: taskSlug });
          }
        });
        if (currentDay) days.push(currentDay);
        
        // Render the task list
        let output = '';
        days.forEach(day => {
          if (day.tasks.length > 0) {
            output += `<div class="day-section">`;
            output += `<h2>${day.title}</h2>`;
            output += `<ul class="task-list">`;
            day.tasks.forEach(task => {
              output += `<li class="task-item">`;
              output += `<a href="./tehtava.html?slug=${encodeURIComponent(task.slug)}">${task.title}</a>`;
              output += `</li>`;
            });
            output += `</ul>`;
            output += `</div>`;
          }
        });
        
        taskListEl.innerHTML = output || '<p>Ei tehtäviä löytynyt.</p>';
      } catch (e) {
        taskListEl.innerHTML = '<p>Virhe sisällön latauksessa. Tarkista verkkoyhteys ja yritä uudelleen.</p>';
        console.error(e);
      }
    })();
  </script>
  <script src="animations.js" defer></script>
</body>
</html>
